"use strict";function _typeof(n){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n})(n)}function _classCallCheck(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(n,e){for(var t=0;t<e.length;t++){var o=e[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(n,o.key,o)}}function _createClass(n,e,t){return e&&_defineProperties(n.prototype,e),t&&_defineProperties(n,t),n}var connection=navigator.connection||navigator.mozConnection||navigator.webkitConnection,type=connection.type,networkStatus=!0,DBHelper=function(){function n(){_classCallCheck(this,n)}return _createClass(n,null,[{key:"fetchRestaurants",value:function(e,t){var o=n.DATABASE_URL;o=t?n.DATABASE_URL+"/"+t:n.DATABASE_URL,fetch(o).then(function(n){n.json().then(function(n){console.log("restaurants JSON: ",n),e(null,n)})})["catch"](function(n){var t="Request failed. Returned ".concat(n);e(t,null)})}},{key:"fetchRestaurantById",value:function(e,t){n.fetchRestaurants(function(n,o){if(n)console.log("callback type: ".concat(_typeof(t))),t(n,null);else{var a=o.find(function(n){return n.id==e});a?t(null,a):t("Restaurant does not exist",null)}})}},{key:"fetchRestaurantByCuisine",value:function(e,t){n.fetchRestaurants(function(n,o){if(n)e(n,null);else{var a=o.filter(function(n){return n.cuisine_type==t});e(null,a)}})}},{key:"fetchRestaurantByNeighborhood",value:function(e,t){n.fetchRestaurants(function(n,o){if(n)e(n,null);else{var a=o.filter(function(n){return n.neighborhood==t});e(null,a)}})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(e,t,o){n.fetchRestaurants(function(n,a){if(n)o(n,null);else{var r=a;"all"!=e&&(r=r.filter(function(n){return n.cuisine_type==e})),"all"!=t&&(r=r.filter(function(n){return n.neighborhood==t})),o(null,r)}})}},{key:"fetchNeighborhoods",value:function(e){n.fetchRestaurants(function(n,t){if(n)e(n,null);else{var o=t.map(function(n,e){return t[e].neighborhood}),a=o.filter(function(n,e){return o.indexOf(n)==e});e(null,a)}})}},{key:"fetchCuisines",value:function(e){n.fetchRestaurants(function(n,t){if(n)e(n,null);else{var o=t.map(function(n,e){return t[e].cuisine_type}),a=o.filter(function(n,e){return o.indexOf(n)==e});e(null,a)}})}},{key:"urlForRestaurant",value:function(n){return"./restaurant.html?id=".concat(n.id)}},{key:"imageUrlForRestaurant",value:function(n){return"/img/".concat(n.id,".jpg")}},{key:"mapMarkerForRestaurant",value:function(e,t){var o=new L.marker([e.latlng.lat,e.latlng.lng],{title:e.name,alt:e.name,url:n.urlForRestaurant(e)});return o.addTo(newMap),o}},{key:"checkConnection",value:function(){return networkStatus===!0}},{key:"updateConnectionStatus",value:function(){"none"==type&&" none"==connection.type?(console.log("Connection has been lost"),networkStatus=!1):(console.log("Connection reestablished"),networkStatus=!0),console.log("Connection type changed from "+type+" to "+connection.type),type=connection.type}},{key:"addUpdateReviewIDB",value:function(n){}},{key:"saveReview",value:function(e,t,o,a,r){var u=n.DATABASE_URL_REVIEWS,c={restaurant_id:e,name:t,rating:o,comments:a,createdAt:Date.now()};if(networkStatus===!1){var i=(new Date).getTime();c.id=i,c.offlineFlag=!0}fetch(u,{method:"post",body:JSON.stringify(c)}).then(function(n){n.json().then(function(n){r(null,n)})})["catch"](function(n){var e="Submission to server failed: ".concat(n);r(e,null)})}},{key:"fetchReviewByRestaurantId",value:function(e,t){var o="".concat(n.DATABASE_URL_REVIEWS,"?restaurant_id=").concat(e);console.log(o),fetch(o).then(function(n){n.json().then(function(n){n||t(error,null),t(null,n)})})["catch"](function(n){t("Review request failed: Returned ".concat(n),null)})}},{key:"DATABASE_URL",get:function(){var n=1337;return"http://localhost:".concat(n,"/restaurants")}},{key:"DATABASE_URL_REVIEWS",get:function(){var n=1337;return"http://localhost:".concat(n,"/reviews/")}}]),n}();
//# sourceMappingURL=dbhelper.js.map
