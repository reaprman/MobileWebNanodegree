"use strict";function modalToggle(){var e=document.getElementById("modal");e.classList.toggle("show-modal")}var restaurant,newMap;document.addEventListener("DOMContentLoaded",function(e){initMap()});var initMap=function(){fetchRestaurantFromURL(function(e,t){e?console.error(e):(self.newMap=L.map("map",{center:[t.latlng.lat,t.latlng.lng],zoom:16,scrollWheelZoom:!1}),L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token={mapboxToken}",{mapboxToken:"pk.eyJ1IjoidGhlZ3JlYXRkZWJhdGUiLCJhIjoiY2pqeHhjY2V4YWh4ZDNxbGZtMXAxdndmdSJ9.buoZhVfjmQ4MLiAk0B4vaA",maxZoom:18,attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',id:"mapbox.streets"}).addTo(newMap),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.newMap))})},fetchRestaurantFromURL=function(e){if(self.restaurant)return void e(null,self.restaurant);var t=getParameterByName("id");if(t)DBHelper.fetchRestaurantById(t,function(t,n){return self.restaurant=n,n?(fillRestaurantHTML(),void e(null,n)):void console.error(t)});else{var n="No restaurant id in URL";e(n,null)}},fillRestaurantHTML=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.restaurant,t=document.getElementById("restaurant-name");t.innerHTML=e.name;var n=document.getElementsByClassName("rest-header")[0],a=!(!e.is_favorite||"true"!==e.is_favorite.toString()),r=document.createElement("button");r.style.background=a?'url("/img/like.svg") no-repeat':'url("/img/not-like.svg") no-repeat',a?r.setAttribute("aria-label","".concat(e.name," favorite")):r.setAttribute("aria-label","".concat(e.name," not favorite")),r.id="fav-icon-".concat(e.id),r.onclick=function(t){return handleFavClick(e.id,!a)},n.appendChild(r);var o=document.getElementById("restaurant-address");o.innerHTML=e.address;var i=document.getElementById("restaurant-img"),l=DBHelper.imageUrlForRestaurant(e),c=l.split("."),d=c[0]+"-400_1x."+c[1],s=c[0]+"-800_2x."+c[1],m=c[0]+"-1600."+c[1];i.className="restaurant-img",i.src=d,i.srcset="".concat(m," 1600w, ").concat(s," 800w, ").concat(d," 400w"),i.sizes="(max-width: 400px) 400px, (max-width: 800px) 800px, (max-width: 1200px) 1600px",i.alt=e.name;var u=document.getElementById("restaurant-cuisine");u.innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),DBHelper.fetchReviewByRestaurantId(e.id,function(e,t){fillReviewsHTML(e,t)}),fillReviewModal()},handleFavClick=function e(t,n){var a=document.getElementById("fav-icon-".concat(t));console.log("onclick info: ".concat(self.restaurant[t]));var r=self.restaurant;r.is_favorite=n,n?(a.setAttribute("aria-label","".concat(r.name," favorite")),a.style.background="url(/img/like.svg) no-repeat"):(a.setAttribute("".concat(r.name," not favorite")),a.style.background="url(/img/not-like.svg) no-repeat"),DBHelper.updateRestaurantIDB(r,function(e,t){e&&console.log("Error updating favorite status for ".concat(r.name,": ").concat(e)),console.log(t)}),a.onclick=function(a){return e(t,!n)}},fillReviewModal=function(){var e=document.getElementById("rvw-rate"),t=[1,2,3,4,5];t.forEach(function(t){var n=document.createElement("option");n.value=t,n.innerText=t.toString(),e.append(n)});var n=document.getElementsByClassName("close-btn")[0];n.addEventListener("click",modalToggle),window.addEventListener("click",function(e){"modal"==e.target.id&&modalToggle()});var a=document.getElementsByClassName("submit-btn")[0];a.addEventListener("click",function(){var e=document.getElementsByClassName("rvw-reviewer")[0].value,t=document.getElementsByClassName("rvw-rate")[0].value,n=document.getElementsByClassName("rvw-comment")[0].value;DBHelper.saveReview(self.restaurant.id,e,t,n,function(e,t){e&&console.log("Error saving review: ".concat(e)),window.location.href="/restaurant.html?id=".concat(self.restaurant.id)})})},fillRestaurantHoursHTML=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.restaurant.operating_hours,t=document.getElementById("restaurant-hours");for(var n in e){var a=document.createElement("tr"),r=document.createElement("td");r.innerHTML=n,a.appendChild(r);var o=document.createElement("td");o.innerHTML=e[n],a.appendChild(o),t.appendChild(a)}},fillReviewsHTML=function(e,t){e&&console.log("Error displaying reviews: ".concat(e)),self.restaurant.reviews=t;var n=document.getElementById("reviews-container"),a=document.createElement("div");a.className="rvw-header";var r=document.createElement("h2");r.innerHTML="Reviews",a.appendChild(r);var o=document.createElement("a");if(o.innerHTML="Add Review",o.className="add-link",o.onclick=modalToggle,a.appendChild(o),n.appendChild(a),!t){var i=document.createElement("p");return i.innerHTML="No reviews yet!",void n.appendChild(i)}var l=document.getElementById("reviews-list");t.forEach(function(e){l.appendChild(createReviewHTML(e))}),n.appendChild(l)},createReviewHTML=function(e){var t=document.createElement("li"),n=document.createElement("p");n.innerHTML=e.name,t.appendChild(n);var a=document.createElement("p");a.innerHTML=new Date(e.createdAt).toDateString(),t.appendChild(a);var r=document.createElement("p");r.innerHTML="Rating: ".concat(e.rating),t.appendChild(r);var o=document.createElement("p");return e.comments?o.innerHTML=e.comments:o.innerHTML=e.comment,t.appendChild(o),t},fillBreadcrumb=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.restaurant,t=document.getElementById("breadcrumb"),n=document.createElement("li");n.innerHTML=e.name,t.appendChild(n)},getParameterByName=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]".concat(e,"(=([^&#]*)|&|#|$)")),a=n.exec(t);return a?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null};
//# sourceMappingURL=restaurant_info.js.map
